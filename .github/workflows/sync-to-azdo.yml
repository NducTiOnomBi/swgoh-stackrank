name: Sync characterBaseData.json to Azure DevOps

on:
  push:
    branches:
      - main
    paths:
      - "Data/characterBaseData.json"

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout GitHub repo
        uses: actions/checkout@v4

      - name: Setup SSH for Azure DevOps
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.AZDO_SSH_KEY }}" > ~/.ssh/id_ed25519
          chmod 600 ~/.ssh/id_ed25519
          ssh-keyscan ssh.dev.azure.com >> ~/.ssh/known_hosts

      - name: Clone Azure DevOps repo (dev branch)
        run: |
          git clone \
            --branch dev \
            git@ssh.dev.azure.com:v3/xAgentSoftware/xas/swgoh-stackrank \
            azdo

      - name: Copy updated file
        run: |
          cp Data/characterBaseData.json \
             azdo/swgoh-stackrank-webapp/swgoh-stackrank-webapp/Data/

      - name: Commit & Push changes
        run: |
          cd azdo
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          
          if git diff --quiet; then
            echo "No changes."
            exit 0
          fi
          
          git add .
          git commit -m "Sync characterBaseData.json from GitHub main"
          git push origin dev
